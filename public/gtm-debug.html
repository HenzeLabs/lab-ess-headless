<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GTM Analytics Debug Console</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 20px;
      line-height: 1.6;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    h1 {
      color: #4fc3f7;
      margin-bottom: 10px;
      font-size: 24px;
    }

    .subtitle {
      color: #888;
      margin-bottom: 30px;
      font-size: 14px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .card {
      background: #252526;
      border: 1px solid #3e3e42;
      border-radius: 8px;
      padding: 20px;
    }

    .card h2 {
      color: #569cd6;
      font-size: 16px;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .status {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      display: inline-block;
    }

    .status.success { background: #4ec9b0; }
    .status.error { background: #f44747; }
    .status.warning { background: #dcdcaa; }

    .info-row {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #3e3e42;
      font-size: 13px;
    }

    .info-row:last-child {
      border-bottom: none;
    }

    .label {
      color: #9cdcfe;
      font-weight: 500;
    }

    .value {
      color: #ce9178;
      font-family: monospace;
    }

    .btn-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 15px;
    }

    button {
      background: #0e639c;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      font-family: inherit;
      transition: background 0.2s;
    }

    button:hover {
      background: #1177bb;
    }

    button.secondary {
      background: #3e3e42;
    }

    button.secondary:hover {
      background: #4e4e52;
    }

    .log-container {
      background: #1e1e1e;
      border: 1px solid #3e3e42;
      border-radius: 8px;
      padding: 20px;
      max-height: 400px;
      overflow-y: auto;
      font-size: 12px;
    }

    .log-entry {
      margin-bottom: 10px;
      padding: 10px;
      background: #252526;
      border-left: 3px solid #0e639c;
      border-radius: 4px;
    }

    .log-entry.error {
      border-left-color: #f44747;
    }

    .log-entry.success {
      border-left-color: #4ec9b0;
    }

    .log-timestamp {
      color: #858585;
      font-size: 11px;
      margin-bottom: 5px;
    }

    .log-content {
      color: #d4d4d4;
    }

    pre {
      background: #1e1e1e;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
      margin-top: 5px;
      font-size: 11px;
    }

    .event-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      font-size: 12px;
    }

    .event-table th {
      background: #1e1e1e;
      padding: 10px;
      text-align: left;
      color: #569cd6;
      border-bottom: 2px solid #3e3e42;
    }

    .event-table td {
      padding: 8px 10px;
      border-bottom: 1px solid #3e3e42;
    }

    .event-table tr:hover {
      background: #2d2d30;
    }

    .badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 500;
    }

    .badge.ga4 { background: #ff6d00; color: white; }
    .badge.reddit { background: #ff4500; color: white; }
    .badge.taboola { background: #01d4ff; color: #000; }
    .badge.meta { background: #1877f2; color: white; }

    .clear-btn {
      background: #f44747;
      float: right;
    }

    .clear-btn:hover {
      background: #ff5555;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîç GTM Analytics Debug Console</h1>
    <p class="subtitle">Real-time monitoring of GTM, GA4, Reddit, Taboola, and Meta Pixel events</p>

    <div class="grid">
      <!-- GTM Status -->
      <div class="card">
        <h2>
          <span class="status" id="gtm-status"></span>
          Google Tag Manager
        </h2>
        <div class="info-row">
          <span class="label">Container ID:</span>
          <span class="value" id="gtm-id">-</span>
        </div>
        <div class="info-row">
          <span class="label">DataLayer Size:</span>
          <span class="value" id="datalayer-size">-</span>
        </div>
        <div class="info-row">
          <span class="label">Duplicate Scripts:</span>
          <span class="value" id="gtm-duplicates">-</span>
        </div>
      </div>

      <!-- GA4 Status -->
      <div class="card">
        <h2>
          <span class="status" id="ga4-status"></span>
          Google Analytics 4
        </h2>
        <div class="info-row">
          <span class="label">Measurement ID:</span>
          <span class="value">G-QCSHJ4TDMY</span>
        </div>
        <div class="info-row">
          <span class="label">Events Fired:</span>
          <span class="value" id="ga4-events">0</span>
        </div>
        <div class="info-row">
          <span class="label">Last Event:</span>
          <span class="value" id="ga4-last">-</span>
        </div>
      </div>

      <!-- Reddit Pixel -->
      <div class="card">
        <h2>
          <span class="status" id="reddit-status"></span>
          Reddit Pixel
        </h2>
        <div class="info-row">
          <span class="label">Pixel ID:</span>
          <span class="value">a2_hwuo2umsdjch</span>
        </div>
        <div class="info-row">
          <span class="label">Events Fired:</span>
          <span class="value" id="reddit-events">0</span>
        </div>
        <div class="info-row">
          <span class="label">Last Event:</span>
          <span class="value" id="reddit-last">-</span>
        </div>
      </div>

      <!-- Taboola Pixel -->
      <div class="card">
        <h2>
          <span class="status" id="taboola-status"></span>
          Taboola Pixel
        </h2>
        <div class="info-row">
          <span class="label">Pixel Loaded:</span>
          <span class="value" id="taboola-loaded">-</span>
        </div>
        <div class="info-row">
          <span class="label">Events Fired:</span>
          <span class="value" id="taboola-events">0</span>
        </div>
        <div class="info-row">
          <span class="label">Last Event:</span>
          <span class="value" id="taboola-last">-</span>
        </div>
      </div>
    </div>

    <!-- Test Buttons -->
    <div class="card">
      <h2>üß™ Test Events</h2>
      <div class="btn-group">
        <button onclick="testViewItem()">View Item</button>
        <button onclick="testAddToCart()">Add to Cart</button>
        <button onclick="testBeginCheckout()">Begin Checkout</button>
        <button onclick="testPurchase()">Purchase</button>
        <button onclick="testNewsletter()">Newsletter Signup</button>
        <button class="secondary" onclick="clearLogs()">Clear Logs</button>
      </div>
    </div>

    <!-- Event Log -->
    <div class="card">
      <h2>
        üìä Event Log
        <button class="clear-btn" onclick="clearLogs()">Clear</button>
      </h2>
      <div id="event-log" class="log-container">
        <div class="log-entry">
          <div class="log-timestamp">Waiting for events...</div>
          <div class="log-content">Fire test events using the buttons above or navigate the site normally.</div>
        </div>
      </div>
    </div>

    <!-- Event Table -->
    <div class="card">
      <h2>üìã All Events</h2>
      <table class="event-table">
        <thead>
          <tr>
            <th>Time</th>
            <th>Platform</th>
            <th>Event</th>
            <th>Details</th>
          </tr>
        </thead>
        <tbody id="event-table-body">
          <tr>
            <td colspan="4" style="text-align: center; color: #888;">No events yet</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <script>
    // Track events
    let eventLog = [];
    let ga4Count = 0;
    let redditCount = 0;
    let taboolaCount = 0;

    // Initialize monitoring
    function init() {
      checkGTM();
      monitorDataLayer();
      monitorReddit();
      monitorTaboola();
      setInterval(updateUI, 1000);
    }

    function checkGTM() {
      const gtmScripts = document.querySelectorAll('script[src*="googletagmanager.com/gtm.js"]');
      const hasGTM = gtmScripts.length > 0;
      const hasDuplicates = gtmScripts.length > 1;

      document.getElementById('gtm-status').className = `status ${hasGTM ? 'success' : 'error'}`;
      document.getElementById('gtm-duplicates').textContent = hasDuplicates ? '‚ö†Ô∏è YES' : '‚úì NO';

      if (gtmScripts.length > 0) {
        const match = gtmScripts[0].src.match(/id=(GTM-[A-Z0-9]+)/);
        document.getElementById('gtm-id').textContent = match ? match[1] : 'Unknown';
      }

      logEvent('GTM', `GTM ${hasGTM ? 'loaded' : 'not found'}`, hasGTM ? 'success' : 'error');
    }

    function monitorDataLayer() {
      if (!window.dataLayer) {
        document.getElementById('ga4-status').className = 'status error';
        return;
      }

      document.getElementById('ga4-status').className = 'status success';

      const originalPush = window.dataLayer.push.bind(window.dataLayer);
      window.dataLayer.push = function(entry) {
        if (entry.event) {
          ga4Count++;
          logEvent('GA4', entry.event, 'success', entry.ecommerce || {});
          document.getElementById('ga4-last').textContent = entry.event;
        }
        return originalPush(entry);
      };
    }

    function monitorReddit() {
      const checkReddit = setInterval(() => {
        if (window.rdt) {
          document.getElementById('reddit-status').className = 'status success';
          document.getElementById('reddit-events').textContent = 'Pixel Loaded';

          const originalRdt = window.rdt;
          window.rdt = function(...args) {
            if (args[0] === 'track') {
              redditCount++;
              logEvent('Reddit', args[1], 'success', args[2] || {});
              document.getElementById('reddit-last').textContent = args[1];
            }
            return originalRdt.apply(this, args);
          };

          clearInterval(checkReddit);
        }
      }, 500);

      setTimeout(() => {
        if (!window.rdt) {
          document.getElementById('reddit-status').className = 'status warning';
          logEvent('Reddit', 'Pixel not loaded - add base script to GTM', 'error');
        }
        clearInterval(checkReddit);
      }, 5000);
    }

    function monitorTaboola() {
      if (!window._tfa) {
        document.getElementById('taboola-status').className = 'status warning';
        document.getElementById('taboola-loaded').textContent = '‚ö†Ô∏è Not Loaded';
        return;
      }

      document.getElementById('taboola-status').className = 'status success';
      document.getElementById('taboola-loaded').textContent = '‚úì YES';

      const originalPush = window._tfa.push.bind(window._tfa);
      window._tfa.push = function(entry) {
        if (entry.name) {
          taboolaCount++;
          logEvent('Taboola', entry.name, 'success', entry);
          document.getElementById('taboola-last').textContent = entry.name;
        }
        return originalPush(entry);
      };
    }

    function logEvent(platform, eventName, type, data = {}) {
      const timestamp = new Date().toLocaleTimeString();

      eventLog.push({
        timestamp,
        platform,
        eventName,
        type,
        data
      });

      addToEventLog(timestamp, platform, eventName, type, data);
      addToEventTable(timestamp, platform, eventName, data);
    }

    function addToEventLog(timestamp, platform, eventName, type, data) {
      const logContainer = document.getElementById('event-log');

      // Remove "waiting" message
      if (logContainer.children.length === 1 && logContainer.children[0].textContent.includes('Waiting')) {
        logContainer.innerHTML = '';
      }

      const entry = document.createElement('div');
      entry.className = `log-entry ${type}`;
      entry.innerHTML = `
        <div class="log-timestamp">${timestamp}</div>
        <div class="log-content">
          <strong>[${platform}]</strong> ${eventName}
          <pre>${JSON.stringify(data, null, 2)}</pre>
        </div>
      `;

      logContainer.insertBefore(entry, logContainer.firstChild);

      // Keep max 50 entries
      while (logContainer.children.length > 50) {
        logContainer.removeChild(logContainer.lastChild);
      }
    }

    function addToEventTable(timestamp, platform, eventName, data) {
      const tableBody = document.getElementById('event-table-body');

      // Remove "no events" row
      if (tableBody.rows.length === 1 && tableBody.rows[0].cells[0].colSpan === 4) {
        tableBody.innerHTML = '';
      }

      const row = tableBody.insertRow(0);
      row.innerHTML = `
        <td>${timestamp}</td>
        <td><span class="badge ${platform.toLowerCase()}">${platform}</span></td>
        <td>${eventName}</td>
        <td>${JSON.stringify(data).substring(0, 100)}...</td>
      `;
    }

    function updateUI() {
      if (window.dataLayer) {
        document.getElementById('datalayer-size').textContent = window.dataLayer.length;
      }
      document.getElementById('ga4-events').textContent = ga4Count;
      document.getElementById('reddit-events').textContent = redditCount;
      document.getElementById('taboola-events').textContent = taboolaCount;
    }

    function clearLogs() {
      eventLog = [];
      document.getElementById('event-log').innerHTML = '<div class="log-entry"><div class="log-timestamp">Logs cleared</div></div>';
      document.getElementById('event-table-body').innerHTML = '<tr><td colspan="4" style="text-align: center; color: #888;">No events yet</td></tr>';
    }

    // Test functions
    function testViewItem() {
      if (!window.__labAnalytics) {
        alert('Analytics not loaded yet. Wait a moment and try again.');
        return;
      }
      window.__labAnalytics.trackViewItem({
        id: 'TEST-001',
        name: 'Test Microscope',
        price: 299.99,
        currency: 'USD',
        quantity: 1,
        category: 'Microscopes'
      });
    }

    function testAddToCart() {
      if (!window.__labAnalytics) {
        alert('Analytics not loaded yet. Wait a moment and try again.');
        return;
      }
      window.__labAnalytics.trackAddToCart({
        id: 'TEST-001',
        name: 'Test Microscope',
        price: 299.99,
        currency: 'USD',
        quantity: 1,
        category: 'Microscopes'
      });
    }

    function testBeginCheckout() {
      if (!window.__labAnalytics) {
        alert('Analytics not loaded yet. Wait a moment and try again.');
        return;
      }
      window.__labAnalytics.trackBeginCheckout([{
        id: 'TEST-001',
        name: 'Test Microscope',
        price: 299.99,
        currency: 'USD',
        quantity: 1,
        category: 'Microscopes'
      }]);
    }

    function testPurchase() {
      if (!window.__labAnalytics) {
        alert('Analytics not loaded yet. Wait a moment and try again.');
        return;
      }
      window.__labAnalytics.trackPurchase({
        orderId: 'TEST-' + Date.now(),
        value: 299.99,
        currency: 'USD',
        items: [{
          id: 'TEST-001',
          name: 'Test Microscope',
          price: 299.99,
          currency: 'USD',
          quantity: 1,
          category: 'Microscopes'
        }]
      });
    }

    function testNewsletter() {
      if (!window.__labAnalytics) {
        alert('Analytics not loaded yet. Wait a moment and try again.');
        return;
      }
      window.__labAnalytics.trackNewsletterSignup('test@example.com');
    }

    // Start monitoring
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  </script>
</body>
</html>
